{"version":3,"file":"table-adapter.js","sourceRoot":"","sources":["table-adapter.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Observable,\n  Subject,\n  BehaviorSubject,\n  fromEvent,\n  merge,\n  of,\n  pipe\n} from 'rxjs';\nimport { DataSource } from '@angular/cdk/table';\nimport { MatPaginator, MatSort } from '@angular/material';\nimport { ElementRef } from '@angular/core';\nimport {\n  debounceTime,\n  distinctUntilChanged,\n  map,\n  switchMap\n} from 'rxjs/operators';\n\nexport interface Pagination {\n  pageIndex: number;\n  pageSize: number;\n  length: number;\n}\n\nexport interface Sort {\n  active: string;\n  direction: string;\n}\nexport class TableAdapter extends DataSource<any> {\n  tableData = new BehaviorSubject<{}[]>([]);\n  sourceData = new BehaviorSubject<{}[]>([]);\n  displayedColumns = [];\n  searchColumns = [];\n  pagination = new BehaviorSubject<Pagination>({\n    pageIndex: 0,\n    pageSize: 10,\n    length: this.tableData.value.length\n  });\n  filter = new BehaviorSubject<String>('');\n  sort = new BehaviorSubject<Sort>({\n    active: '',\n    direction: 'asc'\n  });\n\n  constructor(\n    private _data: any,\n    private _displayedColumns?: string[],\n    private _paginator?: MatPaginator,\n    private _sort?: MatSort,\n    private _searchColumns?: string[],\n    private _filterInput?: ElementRef\n  ) {\n    super();\n    if (_searchColumns && _searchColumns.length === 0) {\n      _searchColumns = _displayedColumns;\n    }\n\n    if (_filterInput) {\n      fromEvent(_filterInput.nativeElement, 'keyup')\n        .pipe(debounceTime(100), distinctUntilChanged())\n        .subscribe(() => this.filter.next(_filterInput.nativeElement.value));\n    }\n  }\n\n  /** Connect function called by the table to retrieve one stream containing the data to render. */\n  connect(): Observable<any> {\n    const connectData = [];\n    if (this._filterInput) {\n      connectData.push(this.filter);\n    }\n    if (this._sort) {\n      connectData.push(this._sort.sortChange);\n    }\n    if (this._paginator) {\n      connectData.push(this._paginator.page);\n    }\n\n    return this._data.pipe(\n      map((res: any) => this.setData(res)),\n      switchMap(res => {\n        if (connectData.length > 0) {\n          return merge(...connectData);\n        } else {\n          return of(res);\n        }\n      }),\n      map(() => this.filtering()),\n      map(() => this.sorting()),\n      map(() => this.paging())\n    );\n  }\n\n  setData(data: any[]) {\n    this.sourceData.next(data);\n    this.tableData.next(data);\n    if (this._paginator) {\n      this._paginator.length = this.tableData.value.length;\n    }\n  }\n\n  paging() {\n    if (this._paginator) {\n      this._paginator.length = this.tableData.value.length;\n      const data = this.tableData.value.slice();\n\n      const startIndex = this._paginator.pageIndex * this._paginator.pageSize;\n      return data.splice(startIndex, this._paginator.pageSize);\n    } else {\n      return this.tableData.value;\n    }\n  }\n\n  sorting() {\n    const data = this.tableData.value.slice();\n    if (!this._sort || !this._sort.active || this._sort.direction === '') {\n      return this.tableData.value;\n    }\n\n    data.sort((a, b) => {\n      let propertyA: number | string = '';\n      let propertyB: number | string = '';\n\n      [propertyA, propertyB] = [a[this._sort.active], b[this._sort.active]];\n\n      const valueA = isNaN(+propertyA) ? propertyA : +propertyA;\n      const valueB = isNaN(+propertyB) ? propertyB : +propertyB;\n\n      return (\n        (valueA < valueB ? -1 : 1) * (this._sort.direction === 'asc' ? 1 : -1)\n      );\n    });\n    this.tableData.next(data);\n    return data;\n  }\n\n  filtering() {\n    if (!this._filterInput) {\n      return this.tableData.value;\n    }\n    if (this.filter.value === '') {\n      this.tableData.next(this.sourceData.value);\n      return this.sourceData.value;\n    }\n    const query: string[] = this.filter.value.split(' ');\n    let tableData = this.sourceData.value;\n    query.forEach(q => {\n      tableData = tableData.slice().filter(item => {\n        let exist = false;\n        let result = -1;\n        this._searchColumns.forEach(obj => {\n          if (typeof item[obj] === 'string') {\n            if (\n              typeof item[obj] !== 'undefined' &&\n              typeof query !== 'undefined'\n            ) {\n              const searchStr = item[obj].toLowerCase();\n              result = searchStr.indexOf(q.toLowerCase());\n            }\n          } else if (\n            typeof item[obj] !== 'undefined' &&\n            typeof this.filter.value !== 'undefined'\n          ) {\n            const searchStr2 = item[obj].toString();\n            result = searchStr2.indexOf(q);\n          }\n          if (result !== -1) {\n            exist = true;\n          }\n        });\n        return exist;\n      });\n    });\n    this.tableData.next(tableData);\n    this._paginator.pageIndex = 0;\n    this._paginator.length = tableData.length;\n    return tableData;\n  }\n\n  disconnect() {}\n}\n"]}