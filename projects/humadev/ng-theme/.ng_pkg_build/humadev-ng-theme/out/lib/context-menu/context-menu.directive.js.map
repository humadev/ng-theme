{"version":3,"file":"context-menu.directive.js","sourceRoot":"","sources":["context-menu.directive.ts"],"names":[],"mappings":";;;;AACA,OAAO,EACL,SAAS,EACT,KAAK,EACL,MAAM,EACN,YAAY,EACZ,YAAY,EACZ,SAAS,EACT,UAAU,EAEV,SAAS,EAEV,MAAM,eAAe,CAAC;AACvB,OAAO,EAAE,yBAAyB,EAAE,MAAM,gCAAgC,CAAC;AAE3E,OAAO,EACL,OAAO,EACP,aAAa,EAEb,gBAAgB,EACjB,MAAM,sBAAsB,CAAC;AAC9B,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AAEtD,OAAO,EAAE,kBAAkB,EAAE,MAAM,wBAAwB,CAAC;AAK5D,MAAM;;;;;;;IAqBJ,YACU,KACA,QACD,SACC;QAHA,QAAG,GAAH,GAAG;QACH,WAAM,GAAN,MAAM;QACP,YAAO,GAAP,OAAO;QACN,aAAQ,GAAR,QAAQ;6BAxBQ,IAAI,YAAY,EAAE;sBAQnC,KAAK;2BACa;YACzB,qBAAqB,EAAE,GAAe,EAAE,CAAC,CAAC;gBACxC,MAAM,EAAE,CAAC;gBACT,MAAM,EAAE,CAAC;gBACT,IAAI,EAAE,CAAC;gBACP,KAAK,EAAE,CAAC;gBACR,GAAG,EAAE,CAAC;gBACN,KAAK,EAAE,CAAC;aACT,CAAC;SACH;QAQC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa,EAAE,QAAQ,EAAE,cAAc,CAAC,CAAC;KAC9D;;;;;IAGD,aAAa,CAAC,KAAiB;QAC7B,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,KAAK,CAAC,eAAe,EAAE,CAAC;QACxB,IAAI,CAAC,QAAQ,CAAC,oBAAoB,EAAE,CAAC;QACrC,uBAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QACpC,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;gBAC1B,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,aAAa,EAAE,uBAAuB,CAAC,CAAC;aACrE,CAAC,CAAC;SACJ;QACD,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,CAAC;QAE9B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC/B,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,uBAAuB,CAAC,CAAC;QACtE,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACxB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,eAAe,EAAE,CAAC;;;;;;IAGjB,WAAW,CAAC,KAAK;QACvB,uBAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;QAC9B,uBAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;QAC9B,IAAI,CAAC,WAAW,CAAC,qBAAqB,GAAG,GAAe,EAAE,CAAC,CAAC;YAC1D,MAAM,EAAE,KAAK,CAAC,OAAO;YACrB,MAAM,EAAE,CAAC;YACT,IAAI,EAAE,KAAK,CAAC,OAAO;YACnB,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,GAAG,EAAE,KAAK,CAAC,OAAO;YAClB,KAAK,EAAE,CAAC;SACT,CAAC,CAAC;QACH,uBAAM,gBAAgB,GAAG,IAAI,CAAC,OAAO;aAClC,QAAQ,EAAE;aACV,WAAW,CACV,IAAI,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,EAChC,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,EACvC,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,CACvC;aACA,oBAAoB,CACnB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,EACpC,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAC1C;aACA,oBAAoB,CACnB,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAClC,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,CACvC;aACA,oBAAoB,CACnB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,EACpC,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CACrC;aACA,oBAAoB,CACnB,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,EACrC,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAC1C;aACA,oBAAoB,CACnB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,EACvC,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,CACxC,CAAC;QACJ,uBAAM,MAAM,GAAG,IAAI,aAAa,CAAC;YAC/B,gBAAgB,EAAE,gBAAgB;YAClC,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,EAAE;YACrD,UAAU,EAAE,qBAAqB;SAClC,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACrD,uBAAM,WAAW,GAAG,IAAI,eAAe,CAAC,yBAAyB,CAAC,CAAC;QACnE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QACjD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;;;;;IAGb,YAAY;QAClB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;;;;;IAGvC,cAAc;QACpB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,eAAe,CAAC,SAAS,CAChE,OAAO,CAAC,EAAE;YACR,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/B,CACF,CAAC;;;;;IAGI,eAAe;QACrB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE;YAC9C,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;gBAChD,OAAO;aACR;YACD,IAAI,CAAC,QAAQ,CAAC,oBAAoB,EAAE,CAAC;YACrC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,uBAAuB,CAAC,CAAC;YACzE,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB,CAAC,CAAC;;;;YA5HN,SAAS,SAAC;gBACT,QAAQ,EAAE,iBAAiB;aAC5B;;;;YAnBC,UAAU;YADV,SAAS;YAST,OAAO;YAOA,kBAAkB;;;8BAMxB,MAAM;uBACN,KAAK;yBACL,KAAK;+BACL,SAAS,SAAC,gBAAgB;kCAC1B,KAAK;8BAyBL,YAAY,SAAC,aAAa,EAAE,CAAC,QAAQ,CAAC","sourcesContent":["import { LayoutService } from '../services/layout.service';\nimport {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  Renderer2,\n  ElementRef,\n  ApplicationRef,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport { ContextMenuPanelComponent } from './context-menu-panel.component';\nimport { ContextMenu } from './context-menu';\nimport {\n  Overlay,\n  OverlayConfig,\n  OverlayRef,\n  CdkOverlayOrigin\n} from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { Observable } from 'rxjs';\nimport { ContextMenuService } from './context-menu.service';\n\n@Directive({\n  selector: '[hdContextMenu]'\n})\nexport class ContextMenuDirective {\n  @Output() hdContextMenu = new EventEmitter();\n  @Input() menuID: any; // id dari row yg diklik kanan\n  @Input() menuItem: [ContextMenu]; // data menu yg akan ditampikan, data ini sesuai dengan interface framework contextmenu\n  @ViewChild(CdkOverlayOrigin) _overlayOrigin: CdkOverlayOrigin;\n  @Input() contextMenuOrigin: CdkOverlayOrigin;\n  panel: any;\n  clickWatcher$: any;\n  overlayRef: OverlayRef;\n  active = false;\n  private fakeElement: any = {\n    getBoundingClientRect: (): ClientRect => ({\n      bottom: 0,\n      height: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      width: 0\n    })\n  };\n\n  constructor(\n    private ref: ElementRef,\n    private render: Renderer2,\n    public overlay: Overlay,\n    private _service: ContextMenuService\n  ) {\n    render.setStyle(ref.nativeElement, 'cursor', 'context-menu'); // add context-menu cursor to element used this directive\n  }\n\n  @HostListener('contextmenu', ['$event'])\n  onContextMenu(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n    this._service.closeAllContextMenus();\n    const refs = this._service.getRef();\n    if (refs) {\n      refs.forEach((ref, index) => {\n        this.render.removeClass(ref.nativeElement, 'hd-contextmenu-active');\n      });\n    }\n    this._service.destroyAllRef();\n\n    this._service.setRef(this.ref);\n    this.render.addClass(this.ref.nativeElement, 'hd-contextmenu-active'); // coloring row with class\n    this.createPanel(event);\n    this.addPanelItem();\n    this.watchItemClick();\n    this.outsideListener();\n  }\n\n  private createPanel(event): void {\n    const offsetX = event.offsetX;\n    const offsetY = event.offsetY;\n    this.fakeElement.getBoundingClientRect = (): ClientRect => ({\n      bottom: event.clientY,\n      height: 0,\n      left: event.clientX,\n      right: event.clientX,\n      top: event.clientY,\n      width: 0\n    });\n    const positionStrategy = this.overlay\n      .position()\n      .connectedTo(\n        new ElementRef(this.fakeElement),\n        { originX: 'start', originY: 'bottom' },\n        { overlayX: 'start', overlayY: 'top' }\n      )\n      .withFallbackPosition(\n        { originX: 'start', originY: 'top' },\n        { overlayX: 'start', overlayY: 'bottom' }\n      )\n      .withFallbackPosition(\n        { originX: 'end', originY: 'top' },\n        { overlayX: 'start', overlayY: 'top' }\n      )\n      .withFallbackPosition(\n        { originX: 'start', originY: 'top' },\n        { overlayX: 'end', overlayY: 'top' }\n      )\n      .withFallbackPosition(\n        { originX: 'end', originY: 'center' },\n        { overlayX: 'start', overlayY: 'center' }\n      )\n      .withFallbackPosition(\n        { originX: 'start', originY: 'center' },\n        { overlayX: 'end', overlayY: 'center' }\n      );\n    const config = new OverlayConfig({\n      positionStrategy: positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close(),\n      panelClass: 'contextmenu-overlay'\n    });\n    this.overlayRef = this.overlay.create(config);\n    this._service.setContextMenuOverlay(this.overlayRef);\n    const contextMenu = new ComponentPortal(ContextMenuPanelComponent);\n    this.panel = this.overlayRef.attach(contextMenu);\n    this.active = true;\n  }\n\n  private addPanelItem(): void {\n    this.panel.instance.menuItem = this.menuItem;\n  }\n\n  private watchItemClick(): void {\n    this.clickWatcher$ = this.panel.instance.menuItemClicked.subscribe(\n      emitted => {\n        emitted.callback(this.menuID);\n      }\n    );\n  }\n\n  private outsideListener(): void {\n    this.render.listen('document', 'click', event => {\n      if (event.type === 'click' && event.button === 2) {\n        return;\n      }\n      this._service.closeAllContextMenus();\n      this.render.removeClass(this.ref.nativeElement, 'hd-contextmenu-active');\n      this.active = false;\n    });\n  }\n}\n"]}